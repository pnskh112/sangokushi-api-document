<!-- TOC -->

- [正規化normalization](#正規化normalization)
    - [正規形の定義](#正規形の定義)
        - [第一正規形](#第一正規形)
        - [第二正規形](#第二正規形)
        - [第三正規形](#第三正規形)

<!-- /TOC -->

## 正規化normalization
- 論理設計において、特に理解を深めておくべき概念が、「正規化（normalization）」及びそれによって作られる「正規形（normal form）」
- 実務での論理設計において本当に頭を悩ませることになるのは、一通りの正規化が「終わった後」である。

### 正規形の定義
- データベースで保持するデータの冗長性を排除し、一貫性と効率性を保持するためのデータ形式。
- 一つの情報が複数のテーブルに存在して無穴データ領域と面倒な更新処理を発生させてしまうことがある（冗長性）
- 冗長なデータ保持をしていると、更新処理のタイムラグによってデータの不整合が発生したり、<br>
そもそもデータを登録することができないようなテーブルを作ってしまうことがある（非一貫性）

#### 第一正規形
- 一つのセルに一つの値が含まれている状態

※ 非正規形の状態のテーブル

扶養者
<br>

| 社員ID | 社員名 | 子  |
|------|-----|----|
| 000A | 加藤  | 達夫 |
|      |     | 慎二 |
| 000B | 藤本  |    |
| 001F | 三島  | 淳  |
|      |     | 陽子 |
|      |     | 清美 |

第１正規形その１
<br>

| 社員ID | 社員名 | 子１ | 子２ | 子３ |
|------|-----|----|----|----|
| 000A | 加藤  | 達夫 | 慎二 |    |
| 000B | 藤本  |    |    |    |
| 001F | 三島  | 淳  | 陽子 | 清美 |

第１正規形その２
<br>

| 社員ID | 社員名 | 子  |
|------|-----|----|
| 000A | 加藤  | 達夫 |
| 000A | 加藤  | 慎二 |
| 000B | 藤本  |    |
| 001F | 三島  | 淳  |
| 001F | 三島  | 陽子 |
| 001F | 三島  | 清美 |
↑このテーブルの主キーは？

基本的にはその２を採用することが望ましい場合が多い。<br>
主キーは一部であってもNULLを含んではならない。

これらのテーブルには２つの問題がある
- 主キーを決められない
- このテーブルが意味的に「社員」と「扶養者」という２つのエンティティを含んでしまっている

第１正規形その３
社員

| 社員ID | 社員名 |
|------|-----|
| 000A | 加藤  |
| 000B | 藤本  |
| 001F | 三島  |

扶養者

| 社員ID | 子  |
|------|----|
| 000A | 達夫 |
| 000A | 慎二 |
| 001F | 淳  |
| 001F | 陽子 |
| 001F | 清美 |

※なぜ一つのセルに複数の値を入れてはダメなのか
- セルに複数の値を許せば、主キーが各列の値を一意に決定できないため
- スカラ値（特定の1行の特定の1列）だけのテーブルならば、主キーは、各列を一意に決めることができる

関数従属性（functional dependency）
X=5と定めれば、Y=10のように、Xに対してYが一つに決まる。これを「YはXに従属する」
と表現する。
「X列の値を決めれば、Y列の値が一つに決まる」という、数学の関数と同じことを意味する。


#### 第二正規形
第一正規形（第２正規形でない）テーブル

| 会社コード | 会社名 | 社員ID | 社員名 | 年齢 | 部署  | 部署名 |
|-------|-----|------|-----|----|-----|-----|
| C001  | A商事 | 000A | 加藤  | 40 | D01 | 開発  |
| C001  | A商事 | 000B | 藤本  | 32 | D02 | 人事  |
| C001  | A商事 | 001F | 三島  | 50 | D03 | 営業  |
| C002  | B化学 | 000A | 斉藤  | 47 | D03 | 営業  |
| C002  | B化学 | 009F | 田島  | 25 | D01 | 開発  |
| C002  | B化学 | 010A | 渋谷  | 33 | D04 | 総務  |

このテーブルは、いずれのセルもスカラ値から構成されているので、問題なく第一正規形。<br>
このテーブルの関数従属が「完全」でないため、第２正規形でない。<br>
主キーの一部の列に対して従属する列がある場合、この関係を`部分関数従属`と呼ぶ。<br>
これに対して主キーを構成するすべての列に従属性がある場合を`完全関数従属`と呼ぶ。

* 第二正規形は部分関数従属を解消し、完全関数従属のみのテーブルを作ること

社員

| 会社コード | 社員ID | 社員名 | 年齢  | 部署コード | 部署名 |
| ----- | ---- | --- | --- | ----- | --- |
| C001  | 000A | 加藤  | 40  | D01   | 開発  |
| C001  | 000B | 藤本  | 32  | D02   | 人事  |
| C001  | 001F | 三島  | 50  | D03   | 営業  |
| C002  | 000A | 斉藤  | 47  | D03   | 営業  |
| C002  | 009F | 田島  | 25  | D01   | 開発  |
| C002  | 010A | 渋谷  | 33  | D04   | 総務  |

会社

| 会社コード | 会社名 |
|-------|-----|
| C001  | A商事 |
| C002  | B化学 |

##### 第二正規形のメリット

上記の第二正規化する前の場合、社員の情報が不明の会社があった場合、<br>
この会社をテーブルに登録できない。ダミー値を入れるのは逃げ手。邪道。<br>
根本的な解決になっていない。<br>
第二正規化した方では、社員の情報が不明でも会社テーブルに登録するだけで対応できる。<br>
この観点から、第二正規化というのは「会社」と「社員」という、<br>
それぞれに異なるレベルの実体（エンティティ）を、きちんとテーブルとしても分離してやる作業とも言える。<br>
<br>

正規化とは可逆的な操作で、正規化の逆操作が結合。

#### 第三正規形
TBD